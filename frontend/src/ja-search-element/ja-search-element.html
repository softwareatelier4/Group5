<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-search/paper-search.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/shibui-dropdown-menu/shibui-dropdown-menu.html">

<dom-module id="ja-search-element">
  <template>
    <style>
       :host {
        display: block;
      }

      #div-dropdown {
        flex-basis: 20%;
        background: #fff;
      }

      #div-dropdown button {
        border: none;
        padding: 5px;
        margin: 0;
        width: 100%;
        /* this is completely hardcoded will change later */
        height: 46.38px;
        background-color: rgba(0, 0, 0, 0);
        text-align: left;
        color: #757575;
        cursor: pointer;
      }

      #div-dropdown:hover {
        background: #F7F8FB;
      }

      #div-dropdown button:focus {
        outline: none;
      }

      #location-search {
        flex-basis: 20%;
      }

      #field-search {
        flex-basis: 50%;
        border-top-left-radius: 3px;
        border-bottom-left-radius: 3px;
      }

      paper-button {
        /*max-width: 30px;*/
        box-shadow: none !important;
        flex-basis: 10%;
        background: #F2D847;
        border-top-left-radius: 0px;
        border-bottom-left-radius: 0px;
        margin: 0px;
      }
    </style>

    <div id="div-search" on-keydown="checkForEnter">
      <paper-search-bar label="test" id="field-search" hide-filter-button icon="search" placeholder="General"> </paper-search-bar>
      <div id="div-dropdown">
        <button id="dropdown-toggle" value=""><iron-icon icon="work" suffix style="color: #9B9B9B"></iron-icon> Category : Any </button>
        <shibui-dropdown id="shibui-dropdown" opened="{{opened}}">
          <a on-tap="_selectCategory">Any</a>
          <a on-tap="_selectCategory">Painter</a>
          <a on-tap="_selectCategory">Plumber</a>
          <a on-tap="_selectCategory">Scrum master</a>
        </shibui-dropdown>
      </div>

      <paper-search-bar label="test" id="location-search" hide-filter-button icon="home" placeholder="Location"> </paper-search-bar>
      <paper-button id="button-search" raised>
        <iron-icon icon="search" suffix></iron-icon>
      </paper-button>
    </div>

    <iron-ajax id="search-request" url="http://localhost:3000/search/" params='{{req}}' handle-as="json" on-response="_handleResponse">
    </iron-ajax>
  </template>

  <script>
    Polymer({

      is: 'ja-search-element',

      listeners: {
        'button-search.tap': 'search',
        'dropdown-toggle.tap': '_toggleDropdown',
      },

      properties: {
        results: {
          type: Array,
          value: [],
          reflectToAttribute: true,
          notify: true,
        },
        general: {
          type: String,
          value: "general",
          reflectToAttribute: true,
          notify: true,
        },
        category: {
          type: String,
          value: "category",
          reflectToAttribute: true,
          notify: true,
        },
        location: {
          type: String,
          value: "location",
          reflectToAttribute: true,
          notify: true,
        },
      },

      checkForEnter: function (e) {
        // check if 'enter' was pressed
        // if (e.keyCode === 13) {
        //     this.search();
        // } 
        this.search();
      },

      search: function (e) {
        console.log(this.$['field-search'].query);
        this.general = this.$['field-search'].query;
        this.category = this.$['dropdown-toggle'].value;
        this.req = {
          "general": this.general,
          "category": this.category
        };
        this.$['search-request'].generateRequest();
      },

      _toggleDropdown: function (e) {
        this.$['shibui-dropdown'].toggle();
      },

      _selectCategory: function (e) {
        this.$['dropdown-toggle'].innerHTML =
          "<iron-icon icon='work' suffix style='color: #9B9B9B'></iron-icon> Category : " + e.target.innerHTML;
        if (e.target.innerHTML == "Any") {
          this.$['dropdown-toggle'].value = "";
        } else {
          this.$['dropdown-toggle'].value = e.target.innerHTML;
        }
      },
      _handleResponse: function (response) {
        this.results = response.detail.response;
      },

    });
  </script>
</dom-module>