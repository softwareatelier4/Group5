<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

<dom-module id="ja-search-element">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <!--<paper-input id="field-search">
      <iron-icon icon="search" suffix></iron-icon>
    </paper-input>-->
    <paper-input id="field-search" label="profession">
      <iron-icon icon="search" suffix></iron-icon>
    </paper-input>
    <paper-input id="location-search" label="location">
      <iron-icon icon="search" suffix></iron-icon>
    </paper-input>
    <paper-button id="button-search" raised>Search</paper-button>

    <iron-ajax
            id="search-request"
            url="http://localhost:3000/search/"
            params='{{req}}'
            handle-as="json"
            on-response="_handleResponse">
    </iron-ajax>
  </template>

  <script>
    Polymer({

      is: 'ja-search-element',

      listeners: {
        'button-search.tap': 'search'
      },

      properties: {
        results: {
          type: Array,
          value: [],
          reflectToAttribute: true,
          notify: true,
        },
        location: {
          type: String,
          value: "location",
          reflectToAttribute: true,
          notify: true,
        },
        profession: {
          type: String,
          value: "profession",
          reflectToAttribute: true,
          notify: true,
        },
      },


      search: function(e) {
        console.log(this.$['field-search'].value);
        this.profession = this.$['field-search'].value;
        this.location = this.$['location-search'].value;
        this.req = {"profession": this.profession,
                    "location": this.location};
        this.$['search-request'].generateRequest();
      },

      _handleResponse: function(response) {
        this.results = response.detail.response;
      },

    });
  </script>
</dom-module>
