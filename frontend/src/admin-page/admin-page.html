<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<dom-module id="admin-page">
  <template>
    <style>
       :host {
        display: block;
        color: black;
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:view" data="{{routeData}}" tail="{{subroute}}">
    </app-route>
    <app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}">
    </app-route>

    <paper-button raised id="btn-send">send mail</paper-button>

    <paper-button raised id="btn-pending">get pending</paper-button>

    <ja-pending-list results={{results}}></ja-pending-list>

    <iron-ajax  id="send-mail"
                url="http://localhost:3005/admin/"
                params="{{req}}"
                method="POST"
                handle-as="json">
    </iron-ajax>

    <iron-ajax  id="request-pending"
                url="http://localhost:3005/admin/pending/"
                params="{{req}}"
                method="GET"
                handle-as="json"
                on-response="_handleResponse">
    </iron-ajax>

  </template>
  <script>
    Polymer({
      is: 'admin-page',

      listeners: {
          'btn-send.tap': 'send',
          'btn-pending.tap': 'getPending',
        },

      properties: {
        results: {
          type: Array,
          value: function () {
            return [];
          },
          observer: '_resultsChanged',
        },
        route: {
          type: Object,
        },
        view: {
          type: String,
          reflectToAttribute: true,
        },
        subroute: {
          type: String,
          reflectToAttribute: true,
        },
      },

      _routePageChanged: function (page) {
        this.view = page;
      },

      send: function (e) {
        this.req = {
          'address':'samuele.bischof@sunrise.ch',
          'subject':'prova',
          'content':'<i>ciao</i>',
        };
        this.$['send-mail'].generateRequest();
        console.log('ciao');
      },

      getPending: function (e) {
        this.$['request-pending'].generateRequest();
      },

      _resultsChanged: function (results) {
        this.results = results;
      },

       _handleResponse: function (response) {
        const res = response.detail.response;
        if (response) {
          console.log(res);
        }
      },

    });
  </script>
</dom-module>
