
<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<dom-module id="ja-login">
  <template>
    <style>
      #container {
        position: fixed;
        height: calc(100% - 110px);
        width: 80%!important;
        top: 100px;
        bottom: 0px;
        /*display: flex;*/
        overflow: scroll;
        /*flex-wrap: wrap;*/
        width: 100%;
        color: dimgray;
        background: white;
        border-radius: 3px;
        padding-bottom: 10px;
      }

      paper-input {
        display: block;
      }

      form {
        padding: 50px;
        display: block;
      }
      .title {
        text-align: center;
        display: block;
        width: 0 auto;
      }

      h2 {
        text-align: center;
        font-size: 20px;
      }

      .error {
        color: crimson;
        height: 20px;
      }
    </style>

    <iron-ajax id="login-request"
               url="/login"
               method="POST"
               handle-as="json"
               body={{loginBody}}
               content-type="application/json"
               on-response="_onLoginResponse"></iron-ajax>

    <iron-ajax id="signup-request"
               url="/signup"
               method="POST"
               handle-as="json"
               body={{signupBody}}
               content-type="application/json"
               on-response="_onSignupResponse"></iron-ajax>

    <div id="container">
      <div class=".title">
        <h2>Login page</h2>
      </div>
      <div class="forms">
        <form is="iron-form" class="form" id="login-form">
          <p id="login-error" class="error">{{loginError}}</p>
          <paper-input min-length="3" required id="login-username" label="username"></paper-input>
          <paper-input required id="login-password" label="password" type="password"></paper-input>
          <paper-button id="login-button" raised>login</paper-button>
        </form>
        <form is="iron-form" id="signup-form">
          <p id="signup-error" class="error">{{signupError}}</p>
          <gold-email-input id="signup-email" label="your email address" required auto-validate></gold-email-input>
          <paper-input  id="signup-username"
          required
          label="username"
          error-message="invalid username"></paper-input>
          <paper-input id="signup-password"required label="password" type="password"></paper-input>
          <paper-input id="signup-password-check"required label="repeat password" type="password"></paper-input>
          <paper-button id="signup-button" raised>signup</paper-button>
        </form>
      </div>
    </div>

  </template>

  <script>
    // element registration
    Polymer({
      is: "ja-login",

      listeners : {
        'login-button.tap' : '_onLoginTap',
        'signup-button.tap' : '_onSignupTap'
      },

      properties: {
      },

      _onLoginTap: function(evt) {
        console.log("Pressed login button");
        let username = this.$['login-username'].value || "";
        let password = this.$['login-password'].value || "";
        if (username.length === 0 || password.length === 0) {
          this.loginError = "Empty field(s)";
        } else {
          this.loginBody = {
            userName: username,
            password: password,
          };
          this.loginError = "";
          this.$['login-request'].generateRequest();
        }
      },

      _onLoginResponse: function(evt) {
        // TODO
        console.log("login response");
      },

      _onSignupTap: function(evt) {
        console.log("Pressed signup button");
        let email = this.$['signup-email'].value || "";
        let username = this.$['signup-username'].value || "";
        let password = this.$['signup-password'].value || "";
        let passwordCheck = this.$['signup-password-check'].value || "";
        if (email.length === 0 || username.length === 0 || password.length === 0 || passwordCheck.length === 0) {
          this.signupError = "Empty field(s)";
        } else if (password !== passwordCheck) {
          this.signupError = "Passwords do not match.";
        } else {
          this.signupBody = {
            email: email,
            username: username,
            password: password,
          };
          this.signupError = "";
          this.$['signup-request'].generateRequest();
        }
      },

      _onSignupResponse: function(evt) {
        // TODO
      },

    });
  </script>
</dom-module>
